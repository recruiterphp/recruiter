#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use Recruiter\Recruiter;
use Recruiter\LazyBones;
use Recruiter\Worker;

$db = (new MongoClient())->selectDB('recruiter');
$recruiter = new Recruiter($db);

LazyBones::waitFor(3)
    ->asJobOf($recruiter)
    ->scheduleTo()
    ->execute();

$worker = $recruiter->hire();

$workers = $recruiter->workersAvailableToWork();
foreach ($workers as $workerToAssignWorkTo) {
    $jobs = $recruiter->pickJobFor($workerToAssignWorkTo);
    foreach ($jobs as $job) {
        $recruiter->assignJobTo($job, $workerToAssignWorkTo);
    }
}

$jobs = $worker->workToDo();
foreach ($jobs as $job) {
    $worker->workOn($job);
}

$db->drop();
