#!/bin/zsh

# 1. stop ballancing

# 2. shutdown mongoses services
echo "SHUTDOWN mongos server at port $PORT"
mongo localhost:40000 \
  --eval 'db.getSiblingDB("admin").shutdownServer({force: true})' \
  --quiet > /dev/null 2>&1

# 3. shutdown config mongod services
for PORT in 30100 30101 30102; do
  echo "SHUTDOWN recruiter configuration server at port $PORT"
  mongo localhost:$PORT \
    --eval 'db.getSiblingDB("admin").shutdownServer({force: true})' \
    --quiet > /dev/null 2>&1
done

# 4. shutdown shards mongod services
for PORT in 30000 30001 30002 30010 30011 30012; do
  echo "SHUTDOWN recruiter shard at port $PORT"
  mongo localhost:$PORT \
    --eval 'db.getSiblingDB("admin").shutdownServer({force: true})' \
    --quiet > /dev/null 2>&1
done

rm -rf '.log'
rm -rf '.data'
